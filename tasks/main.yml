---

- name: group {{ jvm_user }}
  group:
    name: "{{ jvm_group }}"
    gid: "{{ jvm_group_id|default(omit) }}"
    state: present

- name: user {{ jvm_user }}
  user:
    name: "{{ jvm_user }}"
    group: "{{ jvm_group }}"
    uid: "{{ jvm_user_id|default(omit) }}"
    state: present

- name: username/password in jmxremote.password
  lineinfile:
    path: /usr/lib/jvm/java-8-oracle/jre/lib/management/jmxremote.password
    line: "{{ user }} {{ password }}"
    owner: "{{ jvm_user }}"
    group: "{{ jvm_group }}"
    mode: 0600
    create: true
    state: present

- name: username/role in jmxremote.access
  lineinfile:
    path: /usr/lib/jvm/java-8-oracle/jre/lib/management/jmxremote.access
    line: "{{ user }} readonly"
    owner: "{{ jvm_user }}"
    group: "{{ jvm_group }}"
    create: true
    state: present

- name: Add CA certificates
  apt:
    name: ca-certificates
    update_cache: true
    state: present

- name: Add java datadog agent for applicative traces
  get_url:
    url: https://search.maven.org/remote_content?g=com.datadoghq&a=dd-java-agent&v=LATEST
    dest: /usr/local/bin/dd-java-agent.jar
